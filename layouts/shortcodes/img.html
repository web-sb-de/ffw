{{ $src := .Get "src" }}
{{ $width := .Get "width" | default "512x" }}
{{ $quality := .Get "quality" | default "q80" }}
{{ $alt := .Get "alt" }}
{{ $class := .Get "class" }}
{{ $style := .Get "style" }}

{{/* Bild aus den Page Resources holen */}}
{{ $img := .Page.Resources.Get $src }}

{{ if $img }}
  {{/* 1. Hauptbild generieren (WebP, resized) */}}
  {{ $options := printf "%s webp %s" $width $quality }}
  {{ $resized := $img.Resize $options }}
  
  {{/* 2. Placeholder generieren (Mini-JPG f√ºr Base64) */}}
  {{ $placeholder := $img.Resize "20x jpg q20" }}
  
  {{/* 3. Ausgabe mit Inline-Base64-Hintergrund */}}
  <img 
    class="{{ $class }}" 
    src="{{ $resized.Permalink }}" 
    alt="{{ $alt }}" 
    width="{{ $resized.Width }}" 
    height="{{ $resized.Height }}" 
    loading="lazy"
    style="background-image: url(data:image/jpeg;base64,{{ $placeholder.Content | base64Encode }}); background-size: cover; background-repeat: no-repeat; {{ $style | safeCSS }}"
  />
{{ else }}
  <!-- Bild nicht gefunden: {{ $src }} -->
   <img class="{{ $class }}" src="{{ $src }}" alt="{{ $alt }}" loading="lazy" style="{{ $style | safeCSS }}" />
{{ end }}